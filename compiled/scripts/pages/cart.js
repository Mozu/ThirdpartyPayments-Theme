define("modules/models-cart",["underscore","modules/backbone-mozu","hyprlive","modules/api"],function(e,t,o,n){var i=t.MozuModel.extend({helpers:["mainImage"],mainImage:function(){var e=this.get("productImages"),t=e&&e[0],n="http://placehold.it/160&text="+o.getLabel("noImages");return t||{ImageUrl:n,imageUrl:n}},initialize:function(){var e="/product/"+this.get("productCode");this.set({Url:e,url:e})}}),r=t.MozuModel.extend({relations:{product:i},validation:{quantity:{min:1}},dataTypes:{quantity:t.MozuModel.DataTypes.Int},mozuType:"cartitem",handlesMessages:!0,helpers:["priceIsModified"],priceIsModified:function(){var e=this.get("unitPrice");return e.baseAmount!=e.discountedAmount},saveQuantity:function(){this.hasChanged("quantity")&&this.apiUpdateQuantity(this.get("quantity"))}}),a=t.MozuModel.extend({mozuType:"cart",handlesMessages:!0,helpers:["isEmpty","count"],relations:{items:t.Collection.extend({model:r})},initialize:function(){this.get("items").on("sync remove",this.fetch,this).on("loadingchange",this.isLoading,this)},isEmpty:function(){return this.get("items").length<1},count:function(){return this.apiModel.count()},toOrder:function(){var e=this;e.apiCheckout().then(function(t){e.trigger("ordercreated",t)})},removeItem:function(e){return this.get("items").get(e).apiModel.del()},addCoupon:function(){var t=this,i=this.get("couponCode"),r=t.get("orderDiscounts");if(r&&e.findWhere(r,{couponCode:i})){var a=n.defer();return a.reject(),a.promise.otherwise(function(){t.trigger("error",{message:o.getLabel("promoCodeAlreadyUsed",i)})}),a.promise}return this.isLoading(!0),this.apiAddCoupon(this.get("couponCode")).then(function(){t.set("couponCode","");var n=e.flatten(e.pluck(e.pluck(t.get("items").models,"attributes"),"productDiscounts")),r=e.flatten(e.pluck(e.pluck(t.get("items").models,"attributes"),"shippingDiscounts")),a=t.get("orderDiscounts").concat(n).concat(r),s=t.get("couponCodes")||[],d=i.toLowerCase(),u=e.find(s,function(e){return e.toLowerCase()===d});u||t.trigger("error",{message:o.getLabel("promoCodeError",i)});var c=!a||!e.find(a,function(e){return e.couponCode.toLowerCase()===d});t.set("tentativeCoupon",u&&c?i:void 0),t.isLoading(!1)})}});return{CartItem:r,Cart:a}}),define("modules/preserve-element-through-render",["underscore"],function(e){return function(t,o,n){var i={};t._preserved=t._preserved||{},e.each(o,function(e){i[e]=t.$(e)}),n.call(t),e.each(i,function(e,o){var n=t._preserved[o];e.length>0&&(!n||0===n.length)&&(n=t._preserved[o]=e),n&&n.length>0&&t.$(o).replaceWith(n)})}}),define("modules/eventbus",["underscore","backbone"],function(e,t){return e.extend({},t.Events)}),define("modules/amazonpay",["modules/jquery-mozu","modules/eventbus","modules/api","hyprlivecontext","underscore"],function(e,t,o,n,i){function r(e,o){var n="walletWidgetDiv",i={sellerId:e,onPaymentSelect:function(){t.trigger("aws-card-selected")},design:{designMode:"responsive"},onError:function(e){console.log(e.getErrorCode()),console.log(e.getErrorMessage())}};o&&(n="readOnlyWalletWidgetDiv",i.displayMode="Read",i.amazonOrderReferenceId=o),new window.OffAmazonPayments.Widgets.Wallet(i).bind(n)}function a(e,o){var n="amazonAddressBookWidgetDiv",i={sellerId:e,design:{designMode:"responsive"},onOrderReferenceCreate:function(e){var o=e.getAmazonOrderReferenceId();t.trigger("aws-referenceOrder-created",{orderReferenceId:o})},onAddressSelect:function(){},onError:function(e){console.log("AmazonPay widget errorCode: "+e.getErrorCode()),console.log("AmazonPay widget erorMessage: "+e.getErrorMessage())}};o&&(delete i.onOrderReferenceCreate,delete i.onAddressSelect,i.displayMode="Read",i.amazonOrderReferenceId=o),new window.OffAmazonPayments.Widgets.AddressBook(i).bind(n)}var s={sellerId:"",clientId:"",buttonColor:"",buttonType:"",usePopUp:!0,isEnabled:!1,isScriptLoaded:!1,viewName:"amazon-checkout",init:function(o){var r=i.findWhere(n.locals.siteContext.checkoutSettings.externalPaymentWorkflowSettings,{name:"PayWithAmazon"});if(r&&r.isEnabled){this.isEnabled=r.isEnabled;var a=this.getValue(r,"environment"),s="sandbox"==a,d=this.getValue(r,"region");this.sellerId=this.getValue(r,"sellerId"),this.clientId=this.getValue(r,"clientId"),this.buttonColor=this.getValue(r,"buttonColor")||"Gold",this.buttonType=this.getValue(r,"buttonType")||"PwA",this.usePopUp="true"==(this.getValue(r,"usepopup")||"true");var u={de:"eu",uk:"eu",us:"na",jp:"jp"};if(this.sellerId&&this.clientId&&o){var c=this;window.sandbox=s?"/sandbox":"","us"!=d&&(window.sandbox+="/lpa");var l="https://static-"+u[d]+".payments-amazon.com/OffAmazonPayments/"+d+window.sandbox+"/js/Widgets.js";window.onAmazonLoginReady=function(){window.amazon.Login.setClientId(c.clientId)},e.getScript(l).done(function(){c.isScriptLoaded=!0,t.trigger("aws-script-loaded")}).fail(function(e){console.log(e)})}}},getValue:function(e,t){var o=i.findWhere(e.credentials,{apiName:t});if(o)return o.value},addCheckoutButton:function(e,o){var i=this;if(i.isEnabled){var r=n.locals.pageContext.secureHost;r+=o?"/cart?cartId="+e+"&isAwsCheckout=true&view="+i.viewName:"/checkout/"+e+"?isAwsCheckout=true&view="+i.viewName,t.on("aws-script-loaded",function(){var e;window.OffAmazonPayments.Button("AmazonPayButton",i.sellerId,{type:i.buttonType,color:i.buttonColor,useAmazonAddressBook:!0,size:o?"medium":"small",authorization:function(){var t={scope:"profile postal_code payments:widget payments:shipping_address",popup:i.usePopUp};e=window.amazon.Login.authorize(t,r)},onError:function(e){console.log("AmazonPay widget errorCode: "+e.getErrorCode()),console.log("AmazonPay widget erorMessage: "+e.getErrorMessage())}})})}},addAddressWidget:function(e){a(this.sellerId,e)},addWalletWidget:function(e){r(this.sellerId,e)}};return s}),define("pages/cart",["modules/backbone-mozu","underscore","modules/jquery-mozu","modules/models-cart","modules/cart-monitor","hyprlivecontext","hyprlive","modules/preserve-element-through-render","modules/amazonPay"],function(e,t,o,n,i,r,a,s,d){function u(e,i){var a=500,s=r.locals.siteContext.checkoutSettings.visaCheckout,d=s.apiKey,u=s.clientId;e||(e=n.Cart.fromCurrent(),i=e.get("subtotal"),a=0,window.V.on("payment.success",function(e){var n=o("#cartform");t.each({digitalWalletData:JSON.stringify(e),digitalWalletType:"VisaCheckout"},function(e,t){n.append(o("<input />",{type:"hidden",name:t,value:e}))}),n.submit()}),window.V.on("payment.cancel",function(e){console.log({cancel:JSON.stringify(e)})}),window.V.on("payment.error",function(e,t){console.warn({error:JSON.stringify(t)})})),t.delay(window.V.init,a,{apikey:d,clientId:u,paymentRequest:{currencyCode:e?e.get("currencyCode"):"USD",subtotal:""+i}})}var c=e.MozuView.extend({templateName:"modules/cart/cart-table",initialize:function(){var e=this;this.listenTo(this.model,"change:couponCode",this.onEnterCouponCode,this),this.codeEntered=!!this.model.get("couponCode"),this.$el.on("keypress","input",function(t){return 13===t.which?(e.codeEntered&&e.handleEnterKey(),!1):void 0}),d.init(n.Cart.fromCurrent().id),d.init(!0);var t=r.locals.siteContext.checkoutSettings.visaCheckout,o=require.mozuData("pagecontext");t.isEnabled&&(window.onVisaCheckoutReady=u,require([o.visaCheckoutJavaScriptSdkUrl],u))},render:function(){s(this,[".v-button",".p-button","#AmazonPayButton"],function(){e.MozuView.prototype.render.call(this)})},updateQuantity:t.debounce(function(e){var t=o(e.currentTarget),n=parseInt(t.val(),10),i=t.data("mz-cart-item"),r=this.model.get("items").get(i);r&&!isNaN(n)&&(r.set("quantity",n),r.saveQuantity())},400),removeItem:function(e){if(require.mozuData("pagecontext").isEditMode)return!1;var t=o(e.currentTarget),n=t.data("mz-cart-item");return this.model.removeItem(n),!1},empty:function(){this.model.apiDel().then(function(){window.location.reload()})},proceedToCheckout:function(){this.model.isLoading(!0)},addCoupon:function(){var e=this;this.model.addCoupon().ensure(function(){e.model.unset("couponCode"),e.render()})},onEnterCouponCode:function(e,t){t&&!this.codeEntered&&(this.codeEntered=!0,this.$el.find("#cart-coupon-code").prop("disabled",!1)),!t&&this.codeEntered&&(this.codeEntered=!1,this.$el.find("#cart-coupon-code").prop("disabled",!0))},autoUpdate:["couponCode"],handleEnterKey:function(){this.addCoupon()}});o(document).ready(function(){var e=n.Cart.fromCurrent(),t={cartView:new c({el:o("#cart"),model:e,messagesEl:o("[data-mz-message-bar]")})};e.on("ordercreated",function(t){e.isLoading(!0),window.location="/checkout/"+t.prop("id")}),e.on("sync",function(){i.setCount(e.count())}),window.cartView=t,i.setCount(e.count()),d.isEnabled&&e.count()>0&&d.addCheckoutButton(e.id,!0)})});